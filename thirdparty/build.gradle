import org.opensearch.hadoop.gradle.BuildPlugin

plugins {
    id 'com.github.johnrengelman.shadow'
    id 'opensearch.hadoop.build'
}

description = "OpenSearch Hadoop Shaded Third-Party Libraries"

configurations {
    shaded {
        transitive = false
        canBeResolved = true
    }
    implementation {
        extendsFrom shaded
    }
}

BuildPlugin.disableTransitiveDependencies(project, configurations.shaded)

dependencies {
    shaded("commons-httpclient:commons-httpclient:3.0.1")
    shaded("org.codehaus.jackson:jackson-mapper-asl:${project.ext.jacksonVersion}")
    shaded("org.codehaus.jackson:jackson-core-asl:${project.ext.jacksonVersion}")
    shaded("com.google.guava:guava:${project.ext.googleGuavaVersion}")
    shaded("software.amazon.awssdk:sdk-core:${project.ext.awsSdkVersion}")
    shaded("software.amazon.awssdk:auth:${project.ext.awsSdkVersion}")
    shaded("software.amazon.awssdk:utils:${project.ext.awsSdkVersion}")
    shaded("software.amazon.awssdk:http-client-spi:${project.ext.awsSdkVersion}")
    shaded("software.amazon.awssdk:regions:${project.ext.awsSdkVersion}")
    shaded("software.amazon.awssdk:profiles:${project.ext.awsSdkVersion}")
    shaded("software.amazon.awssdk:aws-json-protocol:${project.ext.awsSdkVersion}")
    shaded("software.amazon.awssdk:json-utils:${project.ext.awsSdkVersion}")
    shaded("software.amazon.awssdk:third-party-jackson-core:${project.ext.awsSdkVersion}")
}

shadowJar {
    configurations = [project.configurations.shaded]
    relocate 'org.apache.commons.httpclient', 'org.opensearch.hadoop.thirdparty.apache.commons.httpclient'
    relocate 'org.codehaus.jackson', 'org.opensearch.hadoop.thirdparty.codehaus.jackson'
    relocate 'com.google.common', 'org.opensearch.hadoop.thirdparty.google.common'
    relocate 'software.amazon.awssdk', 'org.opensearch.hadoop.thirdparty.amazon.awssdk'
}